<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhặt đồng xu</title>
    <style>
        /* CSS giữ nguyên */
    </style>
</head>
<body>
    <h1>Nhặt đồng xu</h1>

    <div id="introScreen">
        <p>Làm quen với tớ nhé?</p>
        <input type="text" id="playerName" placeholder="Nhập tên của bạn" />
        <button id="agreeBtn" onclick="startGame()">Đồng ý</button>
        <button id="disagreeBtn" onclick="moveButton()">Không đồng ý</button>
    </div>

    <div id="gameArea">
        <div id="basket" class="basket"></div>
    </div>

    <div id="scoreBoard">Đồng xu đã nhặt: <span id="score">0</span></div>
    <div id="timer">Thời gian còn lại: <span id="time">31</span>s</div>

    <div id="mobileControls" style="display: none;">
        <button class="control-button" onmousedown="startMove('left')" onmouseup="stopMove()" ontouchstart="startMove('left')" ontouchend="stopMove()">
            <div class="triangle-left"></div>
        </button>
        <button class="control-button" onmousedown="startMove('right')" onmouseup="stopMove()" ontouchstart="startMove('right')" ontouchend="stopMove()">
            <div class="triangle-right"></div>
        </button>
    </div>

    <p id="winMessage">Chúc mừng! Bạn đã thắng!</p>
    <p id="reward"></p>
    <button id="claimBtn" onclick="claimReward()" style="display: none;">Nhận phần thưởng</button>

    <script>
        let basket = document.getElementById('basket');
        let gameArea = document.getElementById('gameArea');
        let winMessage = document.getElementById('winMessage');
        let rewardMessage = document.getElementById('reward');
        let claimBtn = document.getElementById('claimBtn');
        let scoreDisplay = document.getElementById('score');
        let timerDisplay = document.getElementById('time');
        let basketX = 270;
        let fallingItems = [];
        let score = 0;
        let timeRemaining = 31;
        let moveInterval;
        let gameInterval, timerInterval;
        let playerName = "";

        function startGame() {
            // Lấy tên người chơi từ ô nhập
            playerName = document.getElementById('playerName').value || "Người chơi";
            document.getElementById('introScreen').style.display = 'none';
            gameArea.style.display = 'block';
            document.getElementById('mobileControls').style.display = 'flex';

            // Reset trạng thái trò chơi
            score = 0;
            scoreDisplay.textContent = score;
            timeRemaining = 31;
            timerDisplay.textContent = timeRemaining;
            fallingItems = [];
            winMessage.style.display = 'none';
            rewardMessage.style.display = 'none';
            claimBtn.style.display = 'none';

            // Bắt đầu trò chơi
            gameInterval = setInterval(gameLoop, 100);
            timerInterval = setInterval(countdown, 1000);
        }

        function countdown() {
            if (timeRemaining > 0) {
                timeRemaining--;
                timerDisplay.textContent = timeRemaining;
            } else {
                endGame();
            }
        }

        function endGame() {
            clearInterval(gameInterval);
            clearInterval(timerInterval);
            showWinMessage();
        }

        function showWinMessage() {
            let cashReward = (Math.floor(score / 10) * 1000).toLocaleString();
            winMessage.style.display = 'block';
            rewardMessage.style.display = 'block';
            rewardMessage.textContent = `${playerName}, bạn đã thu thập được ${cashReward} VND!`;
            claimBtn.style.display = 'inline';
        }

        function claimReward() {
            alert("Số điện thoại liên hệ: 0975070643");
        }

        function moveButton() {
            let btn = document.getElementById('disagreeBtn');
            btn.style.position = 'absolute';
            btn.style.left = Math.random() * (window.innerWidth - btn.offsetWidth) + 'px';
            btn.style.top = Math.random() * (window.innerHeight - btn.offsetHeight) + 'px';
        }

        function gameLoop() {
            if (Math.random() < 0.1) generateFallingItem();
            moveFallingItems();
            checkCollision();
        }

        /* Các hàm generateFallingItem, moveFallingItems, checkCollision giữ nguyên */
    </script>
</body>
</html>
